#!/usr/bin/env bash

export COLORTERM=truecolor

EMACS_DIR="$HOME/.abemacs"
DTACH_SOCK=/tmp/abemacs.dtach
SERVER_NAME="abemacs"

if echo 1 | socat - UNIX-CONNECT:$DTACH_SOCK &> /dev/null; then
    printf "\e[?1006l\e[?1000l\e[?1002l\e[?1003l\e[?1000h\e[?1002h\e[?1003h" # enable mouse
    printf "\e[?2004h" # enable bracketed paste
    printf "\e[>1u" # enable kitty keyboard protocol (disambiguate mode)
    exec dtach -a $DTACH_SOCK -E -z
else
    exec dtach -A $DTACH_SOCK -E -z emacs --init-directory="$EMACS_DIR" -nw
fi
