* Archlinux Zero

** browser

[[file:assets/browser.png]]

** editor

[[file:assets/editor.png]]

** terminal

[[file:assets/terminal.png]]

** monitor

[[file:assets/monitor.png]]

** profiler

[[file:assets/profiler.png]]

** debugger

[[file:assets/debugger.png]]

** manual

[[file:assets/manual.png]]

** clipboard

[[file:assets/clipboard.png]]

** dashboard

[[file:assets/dashboard.png]]

** dictionary

[[file:assets/dictionary.png]]

** keyboard

[[file:assets/keyboard.png]]


* bootstrap

#+BEGIN_SRC bash

timedatectl set-ntp true
# legacy using dos, modern using gpt
fdisk /dev/sdX
mkfs.ext4 /dev/sdX2
mkfs.vfat -F32 /dev/sdX1
mount /dev/sdX2 /mnt
mkdir /mnt/boot
mount /dev/sdX1 /mnt/boot
pacstrap /mnt base
genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc
pacman -S vim

# uncomment needed locales
vim /etc/locale.gen

locale-gen

vim /etc/locale.conf
LANG=en_US.UTF-8

vim /etc/hostname
myhost

passwd

# legacy
grub-install --target=i386-pc /dev/sdX
vim /etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT="quiet transparent_hugepage=madvise"
grub-mkconfig -o /boot/grub/grub.cfg

# efi
bootctl install
vim /boot/loader/entries/arch.conf
title          Arch Linux
linux          /vmlinuz-linux
initrd         /initramfs-linux.img
options        root=UUID=7f653dca-fcb8-49d3-b703-8f6dc033fd03 rw video=DP-4:1920x1080@60 transparent_hugepage=madvise

vim /boot/loader/loader.conf
timeout 4
default arch

useradd -m amos
passwd amos
pacman -S sudo
vim /etc/sudoers/amos
amos ALL=(ALL) NOPASSWD: ALL

#+END_SRC

pacman -S base-devel expac yajl git

* user

#+BEGIN_SRC bash

git clone https://aur.archlinux.org/trizen-git.git
cd trizen-git
makepkg -si

trizen -S ntfs-3g shfmt acpi alsa-lib alsa-utils android-sdk arandr arc-gtk-theme arc-icon-theme arc-kde aspell-en autopep8 bear capitaine-cursors ccache clang cmake compton conky-lua conky-lua cpanminus cups direnv dnsmasq dnsutils docker dstat dunst earlyoom exa exfat-utils expect fcitx-cloudpinyin fcitx-configtool fcitx-gtk2 fcitx-gtk3 fcitx-qt4 fcitx-qt5 fcitx-rime fd fd-rs fzf gconf gdb getmail giflib gnome-themes-standard gnutls go gobject-introspection gpick gpm grc gst-libav gst-plugins-good gst-plugins-ugly gtk-doc gtk3 gtk3 hicolor-icon-theme hplip inotify-tools intltool ipset jansson jdk8-openjdk jq libevent libfdk-aac libmagick6 libotf librsvg libxpm linux-headers llvm lsof lxappearance lxrandr-gtk3 m17n-lib maim mbedtls moreutils mpv mtr ncdu ncurses net-tools netease-cloud-music ninja ninja nmap npm ntp openbsd-netcat openconnect openssh p7zip pandoc-bin paps parallel pavucontrol pdfjs perf pinta pkg-config pkgfile poppler-data prettier pulseaudio pulseaudio-alsa pulseaudio-ctl python-attrs python-black python-language-server python-mccabe python-pycodestyle python-pydocstyle python-pyflakes python-pylint python-pypeg2 python-pyqt5 python-pyqtwebengine python-rope python-sphinx python-virtualenv python-yaml qt5-script qt5-svg qt5-tools qt5-x11extras readline refind-efi ripgrep rofi rslsync rsync ruby samba sdcv sddm simple-obfs slock socat stalonetray strace sxhkd sysdig sysstat tcl tcpdump tesseract tesseract-data-chi_sim tesseract-data-eng tesseract-data-jpn texlive-lang texlive-most texlive-slashbox thinkfan tidy time tokei ttf-dejavu ttf-freefont ttf-inconsolata ttf-ms-fonts ttf-roboto ttf-roboto-slab ttf-ubuntu-font-family ttf-wps-fonts unclutter-xfixes-git unixodbc vala vim vnstat weechat wget wordnet-cli wps-office wqy-microhei-kr-patched xclip xdo xdotool xininfo-git xorg-fonts xorg-fonts-misc xorg-twm xorg-xbacklight xorg-xclock xorg-xdpyinfo xorg-xev xorg-xinput xorg-xlsfonts xorg-xprop xorg-xrdb xorg-xset xorg-xsetroot xorg-xwininfo xsensors xterm yapf zbar zenity zerotier-one zip --noconfirm --needed

trizen -S mimi-git

sudo vim /etc/polkit-1/rules.d/49-nopasswd_global.rules
polkit.addRule(function(action, subject) {
    if (subject.isInGroup("wheel")) {
        return polkit.Result.YES;
    }
});
sudo usermod -aG wheel amos
sudo usermod -aG sys amos
sudo usermod -aG docker amos

#+END_SRC

** builds

#+BEGIN_SRC bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:/usr/local/lib64/pkgconfig:/usr/lib/pkgconfig:/usr/lib64/pkgconfig
BUILD=/home/amos/git/serverconfig/scripts/build

cd ~/git
git clone git@github.com:amosbird/cgdb
cd cgdb && ./autogen.sh && ./configure && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/tmux
cd tmux && ./autogen.sh && ./configure && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/libvte
cd libvte && ./autogen.sh && ./configure --enable-vala=no && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/emacs
cd emacs && ./autogen.sh && ./configure --with-modules && make -j`nproc` && sudo make install

cd ~/git
git clone https://github.com/djcb/mu
cd mu && ./autogen.sh && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/htop-vim
cd htop-vim && ./autogen.sh && ./configure && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/bspwm
cd bspwm && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/reptyr
cd reptyr && bear make -j`nproc` && sudo make install

cd ~/git
git clone --recursive git@github.com:amosbird/termite
cd termite && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/xcape
cd xcape && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/feh
cd feh && bear make -j`nproc` && sudo make install

cd ~/git
git clone git@github.com:amosbird/CopyQ
cd CopyQ && $BUILD rel install

cd ~/git
git clone git@github.com:amosbird/FreeRDP
cd FreeRDP && $BUILD rel install

cd ~/git
git clone git@github.com:amosbird/obs-studio
cd obs-studio && $BUILD obs install

cd ~/git
git clone git@github.com:amosbird/fish-shell
cd fish-shell && $BUILD rel install

cd ~/git
git clone https://github.com/llvm/llvm-project
cd llvm-project && $BUILD llvm

cd ~/git
git clone --recursive git@github.com:amosbird/ccls
cd ccls && $BUILD ccls

cd ~/git
git clone git@github.com:amosbird/fcitx
cd fcitx/pkg
makepkg -si

cd ~/git
git clone git@github.com:amosbird/qutebrowser

cd ~/git
git clone git@github.com:amosbird/cc-playground

git clone git@github.com:amosbird/cc-snippets cc-playground

git clone https://github.com/amosbird/doom-emacs -b amos ~/.emacs.d
cd ~/.emacs.d && make quickstart
open emacs and do M-x all-the-icons-install-fonts

cpanm URL::Search Perl::Tidy Regexp::Common Dir::ls Clipboard File::Find::Rule IPC::Run3
#+END_SRC

** post

# copy these files from the old box
~/passwords
~/.terminfo
~/.userpass
~/.gnupg
~/.getmail
~/.msmtprc
~/.stardict
# might need to remove simsun.ttc mingliu.ttc for tdesktop and emacs-gui
~/.local/share/fonts
~/.local/share/qutebrowser/greasemonkey
~/.local/share/qutebrowser/userscripts
/etc/ld.so.conf.d/99-user-local.conf
/etc/hosts
/etc/netns/zt/resolv.conf
/etc/samba/smb.conf
/etc/cups
/etc/sysctl.d/99-amos.conf
/etc/ipset.conf
/etc/default/earlyoom
/etc/iptables/iptables.rules
/etc/iproute2/rt_tables
/etc/X11/xorg.conf.d
/etc/polkit-1/rules.d
/etc/netctl
/etc/udev/hwdb.d
/usr/local/bin/Telegram
/usr/local/bin/getcursorpos
/usr/local/bin/obfs-local
/usr/local/bin/openconnect
/usr/local/bin/gnirehtet
/usr/local/bin/client_linux_amd64
/etc/thinkfan.conf
/etc/modprobe.d/modprobe.conf
/etc/modules-load.d
/etc/udev/hwdb.d/90-custom-keyboard.hwdb
/etc/udev/rules.d/99-thinkfan.rules
/etc/udev/rules.d/99-trackpoint.rules

cd
sudo cp -r .terminfo /root

mkdir -p Downloads Mail Desktop Pictures/Paste Pictures/Screenshots Videos/Screencasts Music Books org/todos Documents/pdfs Documents/ppts Documents/docs

sddm --example-config | sudo tee /etc/sddm.conf
sudo vim /etc/sddm.conf
User=amos
Session=bspwm.desktop
systemctl enable sddm
systemctl enable org.cups.cupsd.service
systemctl enable dnsmasq
systemctl enable earlyoom
systemctl enable ipset
systemctl enable iptables
systemctl enable sshd
systemctl enable thinkfan
systemctl enable zerotier-one
systemctl enable docker

ccache -M 50G
sudo pkgfile --update
systemctl enable org.cups.cupsd.service
updateroutes
updatednsmasq
